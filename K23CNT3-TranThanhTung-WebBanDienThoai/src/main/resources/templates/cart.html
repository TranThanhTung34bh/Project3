<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Giỏ hàng</title>
    <link rel="stylesheet" th:href="@{/css/main.css}">
</head>
<body>

<div class="main-header">
    <h1>Shop điện thoại</h1>
    <nav class="main-nav">
        <a th:href="@{/}">Trang chủ</a> |
        <a th:href="@{/products}">Sản phẩm</a> |
        <a th:href="@{/cart}">Giỏ hàng</a> |
        <a th:href="@{/admin/login}">Admin</a>
    </nav>
</div>

<div class="product-section cart-table-container">
    <h1>Giỏ hàng của bạn</h1>

    <!-- GIỎ HÀNG TRỐNG -->
    <div th:if="${items.isEmpty()}"
         style="text-align: center; padding: 30px; border: 1px dashed #ccc; background-color: #fff;">
        <p style="font-size: 1.1em; color: #6c757d;">Giỏ hàng hiện đang trống.</p>
        <a th:href="@{/products}" class="action-button primary-button"
           style="margin-top: 15px;">Tiếp tục mua sắm</a>
    </div>

    <!-- GIỎ HÀNG CÓ SẢN PHẨM -->
    <div th:if="${!items.isEmpty()}">
        <table class="data-table">
            <thead>
            <tr>
                <th style="width: 40%;">Sản phẩm</th>
                <th style="width: 15%;">Đơn giá</th>
                <th style="width: 15%; text-align: center;">Số lượng</th>
                <th style="width: 15%; text-align: right;">Thành tiền</th>
                <th style="width: 10%; text-align: center;">Hành động</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="sp : ${items}">
                <td th:text="${sp.tenSP}"></td>

                <td class="column-price">
                    <span th:text="${#numbers.formatInteger(sp.gia, 0, 'COMMA')}"></span>₫
                </td>

                <td class="text-center">
                    <span th:text="${cartMap.get(sp.maSP)}"></span>
                </td>

                <td class="column-total">
                    <span th:with="soLuong=${cartMap.get(sp.maSP)},
                                   thanhTien=${sp.gia * soLuong}"
                          th:text="${#numbers.formatInteger(thanhTien, 0, 'COMMA')}">
                    </span>₫
                </td>

                <td class="column-actions">
                    <a th:href="@{/cart/remove/{id}(id=${sp.maSP})}"
                       class="action-delete"
                       onclick="return confirm('Bạn có chắc muốn xóa sản phẩm này khỏi giỏ hàng?')">
                        Xóa
                    </a>
                </td>
            </tr>
            </tbody>
        </table>

        <!-- ✅ TỔNG TIỀN ĐÚNG – LẤY TỪ CONTROLLER -->
        <h2 style="color: #dc3545; margin-top: 20px;">
            Tổng tiền:
            <span th:text="${#numbers.formatInteger(total, 0, 'COMMA')}"></span>₫
        </h2>

        <!-- FORM THANH TOÁN -->
        <form th:action="@{/checkout}" method="post" class="checkout-form">
            <label for="customerId">Khách hàng ID (ví dụ 1):</label>
            <input id="customerId" type="number" name="customerId"
                   value="1" required style="width: 120px;"/>

            <button type="submit">Thanh toán</button>
        </form>
    </div>
</div>

</body>
</html>